<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CB360_OCORR√äNCIAS</title>
   <style>
    /* ==================== BODY ==================== */
    * {margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent !important; -webkit-touch-callout: none !important;}
    body {font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%); min-height: 100vh; user-select: none;
          transition: all 0.3s ease; display: flex; flex-direction: column; height: 100vh; overflow: hidden;}
    /* ============= DARK MODE OPTIONS ============== */
    .dark-mode {background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); color: #fff;}
    .dark-mode .main-content {background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);}
    .dark-mode .epe-container {background: rgba(45, 45, 45, 0.95); border: 1px solid #444;}
    .dark-mode .epe-container h1 {color: #fff;}
    .dark-mode .epe-title {color: #fff;}
    .dark-mode .occurrences-container {background: rgba(45, 45, 45, 0.95); border: 1px solid #444;}
    .dark-mode .occurrences-container h1 {color: #fff;}
    .dark-mode .table-container {background: rgba(45, 45, 45, 0.95); border: 1px solid #444;}
    .dark-mode table {background: transparent;}
    .dark-mode th {background: linear-gradient(45deg, #d32f2f, #b71c1c);}
    .dark-mode td {color: #fff; border-color: #555;}
    .dark-mode tr:nth-child(even) {background: rgba(255, 255, 255, 0.05);}
    .dark-mode tr:hover {background: rgba(255, 255, 255, 0.1);}
    /* ============= LIGHT MODE OPTIONS ============= */
    .header {background: linear-gradient(45deg, #d32f2f, #b71c1c); color: white; padding: 20px 15px; text-align: center; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); border-bottom: 2px solid #c62828;
             transition: all 0.3s ease; position: fixed; top: 0; left: 0; right: 0; z-index: 1000;}
    .header h1, .header h2 {margin: 0; font-size: 1.5em; font-weight: bold;}
    .header div {margin-top: 5px; font-size: 12px; opacity: 0.9;}
    .header-logo {position: absolute; left: 10px; top: 50%; transform: translateY(-50%); height: 80px; width: auto; border-radius: 8px; transition: all 0.3s ease; z-index: 1001;}
    .footer {background: linear-gradient(45deg, #d32f2f, #b71c1c); color: white; padding: 8px 15px; text-align: center; box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3); border-top: 2px solid #c62828;
             transition: all 0.3s ease; position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000;}
    .footer-content {max-width: 400px; margin: 0 auto;}
    .powered-by {font-size: 13px; font-weight: bold; margin-bottom: 3px; color: #fff}
    .footer-year {font-size: 10px; opacity: 0.8; color: #ffcdd2;}
    .footer strong {color: #ffebee;}
    .main-content {flex: 1; overflow-y: auto; padding-top: 95px; padding-bottom: 80px; padding-left: 20px; padding-right: 20px;}
    .main-content::-webkit-scrollbar {width: 6px;}
    .main-content::-webkit-scrollbar-track {background: rgba(0, 0, 0, 0.1); border-radius: 10px;}
    .main-content::-webkit-scrollbar-thumb {background: linear-gradient(45deg, #d32f2f, #b71c1c); border-radius: 10px;}
    .main-content::-webkit-scrollbar-thumb:hover {background: linear-gradient(45deg, #c62828, #a00000);}    
    .epe-container {background: rgba(255, 255, 255, 0.95); margin: 20px 0; padding: 5px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); transition: all 0.3s ease;
                    animation: fadeIn 0.5s ease-out;}
    .epe-container h1 {color: #2c3e50; margin-bottom: 20px; text-align: center; font-size: 1.8em;}
    .epe-container h1::after {content: ""; display: block; height: 1px; background: rgba(255, 255, 255, 0.2); margin: 15px auto; width: 95%;}
    .message {text-align: center; padding: 10px 15px; margin: 10px auto; border-radius: 5px; font-weight: bold; animation: fadeIn 0.5s ease-out; font-size: 20px; max-width: 300px; width: fit-content;}
    .epe-level-0 {background-color: #459640; color: white;} .epe-level-1 {background-color: #3498db; color: white;} .epe-level-2 {background-color: #f1c40f; color: black;}
    .epe-level-3 {background-color: #e67e22; color: black;} .epe-level-4 {background-color: #e74c3c; color: white;}
    .epe-title {text-align: center; font-size: 15px; font-weight: bold; color: #2c3e50; margin: 15px 0 8px 0; text-transform: uppercase; letter-spacing: 1px;}
    .occurrences-container {background: rgba(255, 255, 255, 0.95); margin: 20px 0; padding: 20px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); transition: all 0.3s ease;
                            animation: fadeIn 0.5s ease-out;}
    .occurrences-container h1 {color: #2c3e50; margin-bottom: 20px; text-align: center; font-size: 1.8em;}
    .occurrences-container h1::after {content: ""; display: block; height: 1px; background: rgba(255, 255, 255, 0.2); margin: 15px auto; width: 95%;}
    .no-occurrences {text-align: center; padding: 20px 15px; background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; border-radius: 5px; font-size: 1.0em; font-weight: bold; width: 300px;
                     height: 40px; margin: 10px auto; box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3); animation: fadeIn 0.5s ease-out; line-height: 40px; padding:0;}
    .table-container {display: none; background: white; border-radius: 5px; overflow: hidden; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); transition: all 0.3s ease;}
    table {width: 100%; border-collapse: collapse; background: transparent;}
    th {background: linear-gradient(45deg, #d32f78, #b71c1c); color: white; padding: 15px 12px; text-align: center; font-weight: bold; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;}
    td {padding: 15px 12px; text-align: center; border-bottom: 1px solid #ecf0f1; font-size: 14px; color: #2c3e50; transition: all 0.3s ease;}
    tr:nth-child(even) {background: #f8f9fa;}
    .message.loading {background: linear-gradient(45deg, #3498db, #2980b9); color: white;}
    .message.error {background: linear-gradient(45deg, #e74c3c, #c0392b); color: white;}
    .message.empty {background: linear-gradient(45deg, #95a5a6, #7f8c8d); color: white;}
    .popup-overlay {display: none; position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center;}
    .popup-container {background: #ddd; color: #000; padding: 0; border-radius: 20px; width: 90%; max-width: 400px; position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.3);}
    .popup-header {background: linear-gradient(145deg, rgba(211, 47, 47, 0.8), rgba(183, 28, 28, 0.8)); padding: 12px 20px; border-top-left-radius: 12px; border-top-right-radius: 12px; font-size: 1.3em;
                   font-weight: bold; text-align: center; color: #fff; backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
                   border-bottom: 2px solid rgba(255, 255, 255, 0.2);}
    .popup-details {margin: 10px 20px; font-size: 0.9em; line-height: 1.4;}
    .popup-message {width: calc(100% - 40px); height: 100px; margin: 10px 20px; padding: 10px 15px; background: rgba(0, 0, 0, 0.1); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
                    color: #000; font-size: 0.95em; border: 1px solid rgba(0, 0, 0, 0.3); border-radius: 3px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); transition: border 0.3s, box-shadow 0.3s;}
    .popup-message:focus {outline: none; border-color: #ddd; box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);}
    .popup-file {margin: 0 20px 20px 20px;}    
    .popup-file::-webkit-file-upload-button {background: #2c80b4; border: none; padding: 6px 12px; color: #fff; border-radius: 4px; cursor: pointer; font-weight: bold; transition: background 0.3s;}
    .popup-file::-webkit-file-upload-button:hover {background: #24618f;}
    .popup-file::-moz-file-upload-button {background: #3498db; border: none; padding: 6px 12px; color: #fff; border-radius: 8px; cursor: pointer; font-weight: bold; transition: background 0.3s;}
    .popup-file::-moz-file-upload-button:hover {background: #24618f;}
    .popup-buttons {display: flex; justify-content: flex-end; gap: 10px; margin: 0 20px 20px 20px;}
    .btn-cancel {padding: 6px 12px; background: #e74c3c; color: #fff; border: none; border-radius: 6px; cursor: pointer; transition: background 0.3s;}
    .btn-cancel:hover {background: #c0392b;}
    .btn-send {padding: 6px 12px; background: #27ae60; color: #fff; border: none; border-radius: 6px; cursor: pointer; transition: background 0.3s;}
    .btn-send:hover {background: #1e8449;}
    /* =================================================
    MEDIA QUERIES - FULL RESPONSIVENESS
    ================================================= */    
    /* ============ RESPONSIVENESS 480px ============ */
    @media (max-width: 480px) {
      html, body {height: 100vh; max-height: 100vh; overflow-x: hidden; overflow-y: auto;}
      .header {padding: 8px 15px;}
      .header h1, .header h2 {font-size: 1.3em !important; margin: 0 !important;}
      .header-logo {height: 50px; top: 32px; left: 10px;}
      .epe-container {margin-top: -10px; margin-bottom: 10px;}
      .epe-container h1 {margin-top: 5px; margin-bottom: 10px;}
      .message {padding: 8px 12px; margin: 8px auto; max-width: 250px; width: fit-content;}
      .occurrences-container {padding: 8px 15px; margin: 0px 0;}
      .occurrences-container h1 {margin-top: 5px; margin-bottom: 10px;}
      .mobile-card {padding: 12px; position: relative; margin: 8px 0;}
      .mobile-card h3 {font-size: 12px;}
      .main-content h1 {font-size: 20px;}
      th {font-size: 12px;}
      td {font-size: 11px;}
      .mobile-card p {font-size: 10px;}
      .footer {padding: 5px 15px;}
      .powered-by {font-size: 11px;}
      .footer-year {font-size: 9px;}
    /* ======== RESPONSIVENESS 481px TO 768px ======= */
    @media (min-width: 481px) and (max-width: 768px) {}    
    /* ======= RESPONSIVENESS 769px TO 1024px ======= */
    @media (min-width: 769px) and (max-width: 1024px) {}
    /* =========== RESPONSIVENESS +1025px =========== */
    @media (min-width: 1025px) {}
    /* =========== RESPONSIVENESS +1440px =========== */
    @media (min-width: 1440px) {}    
    /* ================= LANDSCAPE ================== */
    @media screen and (orientation: landscape) and (max-height: 500px) {
      .header {padding: 8px 15px !important; position: fixed !important; top: 0 !important; z-index: 1000 !important;}
      .header h1, .header h2 {font-size: 1.3em !important; margin: 0 !important;}
      .header-logo {height: 45px !important; left: 8px !important;}
      .header div {font-size: 11px !important; margin-top: 5px !important;}
      .footer {padding: 4px 15px !important;}
      .powered-by {font-size: 10px !important; margin-bottom: 1px !important;}
      .footer-year {font-size: 8px !important;}}
  </style>
</head>
<body>
  <header class="header">
    <img id="corpLogo" class="header-logo" alt="Logo" src="">
    <h1>GEST√ÉO DE OCORR√äNCIAS</h1>
    <h2 id="corpInfo" style="display: none;"></h2>
    <div>Sistema de Visualiza√ß√£o de Ocorr√™ncias</div>
  </header>
  <div class="main-content">
    <div class="epe-container">
      <h1>‚ö†Ô∏è Estados de Prontid√£o Especial ‚ö†Ô∏è</h1>
      <div class="epe-title">EPE DECIR</div>
      <div id="epedecir" class="message loading">Carregando...</div>
      <div class="epe-title">EPE DIOPS</div>
      <div id="epediops" class="message loading">Carregando...</div>
    </div>
    <div class="occurrences-container">
      <h1>üî• Ocorr√™ncias em Curso üî•</h1>
      <div id="messageContainer"></div>
      <div class="table-container">
        <table id="ocorrenciasTable" style="display:none">
          <thead>
            <tr>
              <th>Ocorr√™ncia</th>
              <th>Local</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <div id="occurrencePopupOverlay" class="popup-overlay">
        <div class="popup-container">
          <div id="popupTitle" class="popup-header">T√≠tulo da Ocorr√™ncia</div>
          <div id="popupDetails" class="popup-details"></div>
          <textarea id="popupMessageInput" class="popup-message" placeholder="Descri√ß√£o da Ocorr√™ncia..."></textarea>
          <input type="file" id="popupPhotoInput" class="popup-file" accept="image/*" multiple>
          <div class="popup-buttons">
            <button id="popupCancelBtn" class="btn-cancel">Cancelar</button>
            <button id="popupSendBtn" class="btn-send">Enviar</button>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="footer-content">
          <div class="powered-by">
            <strong>Powered by:</strong> F√°bio Martins | Sistemas de Informa√ß√£o - Grupo CB360
          </div>
          <div class="footer-year">
            ¬© 2023-2025 - Sistema CB360 Mobile
          </div>
        </div>
      </div>
      <div id="noOccurrencesMessage" class="no-occurrences" style="display: none;">
        ‚úÖ N√£o Existem Ocorr√™ncias em Curso
      </div>
    </div>
  </div>
  <script>
    /* ===================== SUPABASE CONFIGURATION ====================== */
    const SUPABASE_URL = 'https://rjkbodfqsvckvnhjwmhg.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJqa2JvZGZxc3Zja3ZuaGp3bWhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxNjM3NjQsImV4cCI6MjA2MzczOTc2NH0.jX5OPZkz1JSSwrahCoFzqGYw8tYkgE8isbn12uP43-0';
    function getSupabaseHeaders(options = {}) {
      const headers = {
        'apikey': SUPABASE_ANON_KEY,
        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
        'Content-Type': 'application/json'
      };
      if (options.returnRepresentation) headers['Prefer'] = 'return=representation';
      return headers;
    }
    /* ================= POPUP ================= */
    const popupOverlay = document.getElementById('occurrencePopupOverlay');
    const popupTitle = document.getElementById('popupTitle');
    const popupDetails = document.getElementById('popupDetails');
    const popupMessageInput = document.getElementById('popupMessageInput');
    const popupPhotoInput = document.getElementById('popupPhotoInput');
    const popupCancelBtn = document.getElementById('popupCancelBtn');
    const popupSendBtn = document.getElementById('popupSendBtn');
    let ocorrenciasData = [];
    let ocorrenciaSelecionada = null;
    const table = document.getElementById('ocorrenciasTable');
    table.querySelector('tbody').addEventListener('click', function(e) {
      const tr = e.target.closest('tr');
      if (!tr) return;
      const index = tr.dataset.index;
      ocorrenciaSelecionada = ocorrenciasData[index];
      popupTitle.textContent = ocorrenciaSelecionada.occorrence;
      popupDetails.innerHTML = `
      <strong>Local:</strong> ${ocorrenciaSelecionada.local}<br>
      <strong>Estado:</strong> ${ocorrenciaSelecionada.status}
      `;
      popupMessageInput.value = '';
      popupPhotoInput.value = '';
      popupOverlay.style.display = 'flex';
    });
    popupCancelBtn.addEventListener('click', () => {
      popupOverlay.style.display = 'none';
    });
    popupSendBtn.addEventListener('click', async () => {
      if (!ocorrenciaSelecionada) return;
      const userMessage = popupMessageInput.value.trim();
      const files = popupPhotoInput.files;
      if (!userMessage && files.length === 0) {
        alert('Escreve uma mensagem ou adiciona pelo menos uma foto!');
        return;
      }
      if (files.length > 10) {
        alert('S√≥ √© permitido enviar no m√°ximo 10 fotos de uma vez.');
        return;
      }
      const finalMessage = `
      <b>üì¢ Atualiza√ß√£o de Ocorr√™ncia</b>
      <b>Ocorr√™ncia:</b> ${ocorrenciaSelecionada.occorrence}
      <b>Local:</b> ${ocorrenciaSelecionada.local}
      <b>Estado:</b> ${ocorrenciaSelecionada.status}
      <b>Observa√ß√µes:</b>
      ${userMessage || '‚Äî'}
      `;
      const formData = new FormData();
      formData.append('message', finalMessage);
      for (let i = 0; i < files.length; i++) {
        formData.append('photos', files[i]);
      }
      try {
        const res = await fetch('https://cb360-online.vercel.app/api/mobile/sendTelegram', {
          method: 'POST',
          body: formData
        });
        const result = await res.json();
        if (result.success) {
          alert('‚úÖ Mensagem enviada com sucesso!');
          popupOverlay.style.display = 'none';
        } else {
          alert('‚ùå Erro ao enviar: ' + result.error);
        }
      } catch (err) {
        console.error('‚ùå Erro ao enviar:', err);
        alert('‚ùå Erro de conex√£o: ' + err.message);
      }
    });
    popupOverlay.addEventListener('click', (e) => {
      if (e.target === popupOverlay) {
        popupOverlay.style.display = 'none';
      }
    });
    /* ======================= CORPORATION LOADING ======================= */
    async function loadCorpInfo() {
      const corpOperNr = localStorage.getItem("currentCorpOperNr");
      const h2 = document.getElementById("corpInfo");
      const titleEl = document.querySelector(".cb-title");
      const logoEl = document.getElementById("corpLogo");
      if (!corpOperNr) {
        if (h2) h2.textContent = "N√£o definido";
        return;
      }
      try {
        const response = await fetch(
          `${SUPABASE_URL}/rest/v1/corporation_data?select=corporation,corp_oper_nr,logo_url&corp_oper_nr=eq.${corpOperNr}`, {
            headers: getSupabaseHeaders()
          }
        );
        const data = await response.json();
        if (data && data.length > 0) {
          const corp = data[0];
          if (h2) h2.textContent = corp.corp_oper_nr || "N/D";
          if (logoEl && corp.logo_url) logoEl.src = corp.logo_url.trim();
          if (titleEl && corp.corporation) titleEl.textContent = formatCorpName(corp.corporation);
        } else {
          if (h2) h2.textContent = "N√£o encontrado";
        }
      } catch (err) {
        console.error('Erro no loadCorpInfo:', err);
        if (h2) h2.textContent = corpOperNr;
      }
    }
    /* =========================== EPE LOADING =========================== */
    let controllerEpe;
    let controllerOcorrencias;
    async function LoadEPE() {
      if (controllerEpe) controllerEpe.abort();
      controllerEpe = new AbortController();
      try {
        const response = await fetch('https://cb360-online.vercel.app/api/mobile/occurrences_control', {
          signal: controllerEpe.signal
        });
        const result = await response.json();
        const epeDecirStatus = document.getElementById('epedecir');
        const epeDiopsStatus = document.getElementById('epediops');
        epeDecirStatus.className = 'message';
        epeDiopsStatus.className = 'message';
        if (result.success && Array.isArray(result.epeData) && result.epeData.length > 0) {
          const epeDecir = result.epeData.find(item => item.epe_type === 'epe-decir');
          if (epeDecir) {
            const epeNivel = epeDecir.epe;
            epeDecirStatus.textContent = epeNivel;
            switch (epeNivel) {
              case 'Monitoriza√ß√£o': case 'MONITORIZA√á√ÉO': epeDecirStatus.classList.add('epe-level-0'); break;
              case 'N√≠vel I': case 'N√çVEL I': epeDecirStatus.classList.add('epe-level-1'); break;
              case 'N√≠vel II': case 'N√çVEL II': epeDecirStatus.classList.add('epe-level-2'); break;
              case 'N√≠vel III': case 'N√çVEL III': epeDecirStatus.classList.add('epe-level-3'); break;
              case 'N√≠vel IV': case 'N√çVEL IV': epeDecirStatus.classList.add('epe-level-4'); break;
              default: epeDecirStatus.classList.add('empty'); break;
            }
          } else {
            epeDecirStatus.textContent = 'EPE-DECIR n√£o encontrado';
            epeDecirStatus.classList.add('empty');
          }
          const epeDiops = result.epeData.find(item => item.epe_type === 'epe-diops');
          if (epeDiops) {
            const epeNivelDiops = epeDiops.epe;
            epeDiopsStatus.textContent = epeNivelDiops;
            switch (epeNivelDiops) {
              case 'Monitoriza√ß√£o': case 'MONITORIZA√á√ÉO': epeDiopsStatus.classList.add('epe-level-0'); break;
              case 'N√≠vel I': case 'N√çVEL I': epeDiopsStatus.classList.add('epe-level-1'); break;
              case 'N√≠vel II': case 'N√çVEL II': epeDiopsStatus.classList.add('epe-level-2'); break;
              case 'N√≠vel III': case 'N√çVEL III': epeDiopsStatus.classList.add('epe-level-3'); break;
              case 'N√≠vel IV': case 'N√çVEL IV': epeDiopsStatus.classList.add('epe-level-4'); break;
              default: epeDiopsStatus.classList.add('empty'); break;
            }
          } else {
            epeDiopsStatus.textContent = 'EPE-DIOPS n√£o encontrado';
            epeDiopsStatus.classList.add('empty');
          }
        } else {
          epeDecirStatus.textContent = 'Sem dados do EPE';
          epeDecirStatus.classList.add('empty');
          epeDiopsStatus.textContent = 'Sem dados do EPE';
          epeDiopsStatus.classList.add('empty');
        }
      } catch (error) {
        if (error.name === 'AbortError') return;
        const epeDecirStatus = document.getElementById('epedecir');
        const epeDiopsStatus = document.getElementById('epediops');
        epeDecirStatus.className = 'message error';
        epeDiopsStatus.className = 'message error';
        epeDecirStatus.textContent = 'Erro ao carregar EPE';
        epeDiopsStatus.textContent = 'Erro ao carregar EPE';
        console.error('Erro ao carregar EPE:', error);
      }
    }
    /* ======================= OCCURRENCES LOADING ======================= */
    async function LoadOccurrences() {
      if (controllerOcorrencias) controllerOcorrencias.abort();
      controllerOcorrencias = new AbortController();
      try {
        const response = await fetch('https://cb360-online.vercel.app/api/mobile/occurrences_control', {
          signal: controllerOcorrencias.signal
        });
        const result = await response.json();
        if (!result.success) {
          console.warn('Erro ao carregar ocorr√™ncias: ' + result.error);
          return;
        }
        const tabela = document.getElementById('ocorrenciasTable');
        const tableContainer = document.querySelector('.table-container');
        const tbody = tabela.querySelector('tbody');
        const noMsg = document.getElementById('noOccurrencesMessage');
        tableContainer.style.display = 'none';
        noMsg.style.display = 'none';
        tbody.innerHTML = '';
        ocorrenciasData = result.ocorrencias || [];
        if (!ocorrenciasData.length) {
          noMsg.style.display = 'block';
          return;
        }
        tableContainer.style.display = 'block';
        tabela.style.display = 'table';
        ocorrenciasData.forEach((item, index) => {
          const tr = document.createElement('tr');
          tr.dataset.index = index;
          tr.innerHTML = `
          <td data-label="Ocorr√™ncia">${item.occorrence}</td>
          <td data-label="Local">${item.local}</td>
          <td data-label="Estado">${item.status}</td>
          `;
          tbody.appendChild(tr);
        });
      } catch (error) {
        if (error.name === 'AbortError') return;
        console.error('Erro ao carregar ocorr√™ncias:', error);
      }
    }
    window.addEventListener('load', function() {
      const savedTheme = localStorage.getItem('sgo-theme');
      if (savedTheme === 'dark') document.body.classList.add('dark-mode');
      loadCorpInfo();
      LoadEPE();
      LoadOccurrences();
      setInterval(LoadEPE, 2000);
      setInterval(LoadOccurrences, 2000);
    });
  </script>
</body>
</html>
